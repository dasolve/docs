# ADR-013: Standardized Folder Structure

## Context

A monorepo (as decided in [ADR-010](./ADR-010.md)) containing multiple polyglot projects ([ADR-002](./ADR-002.md), [ADR-004](./ADR-004.md)) can become chaotic without a strictly enforced folder structure.

To ensure the solution is navigable, maintainable, and scalable, we need a single, logical layout. This is critical for:

1. **Developer Onboarding:** Reducing cognitive load and time-to-first-contribution.

2. **AI/LLM Navigation:** Providing a predictable structure for AI agents to understand, query, and modify the codebase.

3. **Tooling Integration:** Allowing **Moonrepo** ([ADR-010](./ADR-010.md)) to automatically discover projects and apply tasks.

4. **Simplicity:** Ensuring all code lives under a single, unified top-level directory.

## Decision

All Dasolve solutions **must** adhere to the following root-level folder structure. All project source code, whether for deployable applications or shared libraries, will be co-located under the `/packages` directory.

```
/
├── .moon/              # Moonrepo workspace configuration (ADR-010)
│   ├── tasks/          # Shared task configurations (e.g., typescript.yml)
|   |   └── ...
│   ├── toolchain.yml   # Pinned tool versions (Bun, Node, Python, etc.)
│   └── workspace.yml   # Workspace definition, project globs
├── .vscode/            # VSCode editor settings (ADR-009)
│   ├── extensions.json
│   └── settings.json
├── packages/           # [MANDATORY] All source code lives here
│   ├── backend/        # (e.g., main backend-for-frontend API)
│   │   ├── src/
│   │   └── moon.yml
│   ├── datamodels/     # Shared data models/types
│   │   ├── datamodel-core/
│   │   │   ├── src/
│   │   │   └── moon.yml
│   │   └── ...
│   ├── frontend/       # (e.g., main web UI)
│   │   ├── src/
│   │   └── moon.yml
│   ├── functions/      # Shared business logic/utils
│   │   ├── function-auth/
│   │   │   ├── src/
│   │   │   └── moon.yml
│   │   └── ...
│   └── jobs/           # Deployable jobs (e.g., cron, workers)
│       ├── job-process-data/
│       │   ├── src/
│       │   └── moon.yml
│       └── ...
├── docs/               # All project documentation
│   ├── adrs/           # Architecture Decision Records from dasolve framework
│   └── specs/          # Specifications for developers and LLMs to follow during development
│
├── .github/
│   └── copilot-instructions.md  # Instructions for GitHub Copilot
├── .gitignore
├── .kiro/              # Kiro agent configuration
│   ├── steering/       # Steering instructions for Kiro
│   └── specs/          # Specifications for Kiro
├── .prototools         # proto toolchain version file (ADR-008)
├── AGENTS.md           # Instructions for AI agents (Cursor, etc.)
├── CLAUDE.md           # Instructions for Claude-based agents (Cline, etc.)
├── moon.yml            # Moonrepo root project (for workspace tasks)
├── oxlint.json         # Oxlint config (ADR-011)
├── package.json        # Root package.json
├── pyproject.toml      # Python project/Ruff config (ADR-011, ADR-012)
└── README.md           # Project-level README
```

### Key Definitions

1. **`/packages`**: This directory contains **all** project source code.

2. **Internal Package Structure**: This ADR defines the _monorepo_ structure (where to place projects). The specific _internal_ folder structure for each project type (e.g., the layout _inside_ `packages/backend` or `packages/frontend`) will be defined in subsequent, separate ADRs.

3. **`.prototools`**: The mandatory file that defines all toolchain versions (e.g., `bun`, `node`, `python`, `uv`) for the repository, managed by the `proto` version manager as per [ADR-008](./ADR-008.md).

4. **`moon.yml` (Root)**: A Moon project file for the workspace root, enabled by the `.` glob in `workspace.yml`. It is used for defining workspace-wide tasks (e.g., `moon run :lint` to lint everything).

5. **`README.md`**: The primary documentation for the project, outlining its purpose, setup, and usage.

6. **Root-level Config:** All configuration for workspace-wide tasks **must** reside in the root of the repository.

## Consequences

### Positive

- **Ultimate Simplicity:** All project code lives under a single top-level `/packages` directory, simplifying glob patterns and developer navigation.

- **Automatic Discovery:** This structure allows Moonrepo to be configured with specific, wildcard-based globs to find all projects.

- **Centralized Tooling:** Placing all configs (VSCode, Moon, linters, tool versions) at the root makes them easy to find and manage.

### Negative

- **Lost Separation of Concerns:** The clear, top-level structural distinction between deployable "apps" and shareable "packages" is lost. Developers must rely on project naming or inspecting `moon.yml` files to understand a component's purpose.

- **Potential for Confusion:** Without the `apps/` and `packages/` guardrails, there is a risk of projects being created with ambiguous purposes (e.g., a "package" that is also deployed).

## Do's and Don'ts

This section provides clear guidelines for adhering to this decision.

### Do

- **DO** place all project code (applications, libraries, jobs) into a subdirectory under `/packages`.

- **DO** follow the naming conventions required by the Moonrepo globs (e.g., `packages/datamodels/datamodel-core`, `packages/jobs/job-my-job`).

- **DO** add a `moon.yml` file for _every_ project, including the root (`/moon.yml`).

- **DO** define all toolchain versions in the root `.prototools` file ([ADR-008](./ADR-008.md)).

- **DO** place all project documentation in the `/docs` directory.

- **DO** place all global configuration files (linters, formatters) in the repository root.

### Don't

- **DON'T** create any new top-level directories for source code (e.g., `/src`, `/lib`, `/server`, `/apps`). All project code must live within `packages/`.

- **DON'T** create a project with a name that doesn't match the glob patterns in `.moon/workspace.yml` (e.g., `packages/datamodels/core-types` would not be found).

- **DON'T** commit IDE-specific files (like `.idea/`) to the repository. Only `.vscode/` is permitted, as it is the standard ([ADR-009](./ADR-009.md)).

## Compliance and Enforcement

1. **Scaffolding:** All official Dasolve project scaffolding tools will generate this directory structure by default.

2. **Moonrepo Configuration:** The root `.moon/workspace.yml` will be configured with project globs reflecting this structure:

   ```
   projects:
     - "packages/backend"
     - "packages/frontend"
     - "packages/datamodels/datamodel-*"
     - "packages/functions/function-*"
     - "packages/jobs/job-*"
     - "." # Registers the root `moon.yml` as a project
   ```

   Any code placed outside these directories, or not matching these patterns, will be invisible to the build system.

3. **CI/CD Pipeline:** The CI pipeline will fail if `moon` commands fail due to projects not being found or dependencies not being resolved, which will naturally occur if this structure is violated. The CI pipeline must also use the `.prototools` file to install tools ([ADR-008](./ADR-008.md)).

4. **Code Reviews:** Reviewers are responsible for ensuring all new code and projects are placed in the correct directory and follow the required naming conventions.

5. **Exceptions:**
   - Exceptions to this ADR are rare and must be approved by the project's lead architect or the Dasolve framework core maintainers.
   - All approved exceptions must be documented as a separate ADR that outlines the business/technical justification and the scope of the exception.

## References

- [ADR-002: Primary Language for Data-Related Tasks](./ADR-002.md)

- [ADR-004: Python Package Manager](./ADR-004.md)

- [ADR-005: Primary TypeScript Runtime](./ADR-005.md)

- [ADR-008: Toolchain Version Management](./ADR-008.md)

- [ADR-009: VSCode and its forks is the IDE](./ADR-009.md)

- [ADR-010: Moonrepo as the Standard Monorepo Tool](./ADR-010.md)

- [ADR-011: Standardized Linting](./ADR-011.md)

- [ADR-012: Standardized Formatting](./ADR-012.md)
