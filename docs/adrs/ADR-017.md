# ADR-017: Vite as the Frontend Build Tool

## Context

Modern frontend applications require sophisticated build tools to:

- Transform TypeScript and JSX into browser-compatible JavaScript
- Bundle modules efficiently for production deployment
- Provide hot module replacement (HMR) for rapid development
- Optimize assets (code splitting, minification, tree shaking)
- Handle development server with fast refresh
- Support modern ES modules natively

Traditional build tools like Webpack and Create React App (CRA) have limitations:

- **Slow Development Server Startup:** Large projects can take minutes to start the dev server
- **Slow Hot Module Replacement:** Changes can take several seconds to reflect in the browser
- **Complex Configuration:** Webpack requires extensive configuration for optimal setup
- **Deprecated Tools:** Create React App is no longer actively maintained

For **enterprise applications** with large codebases and long development sessions, build tool performance directly impacts developer productivity. Slow feedback loops frustrate developers and reduce iteration speed.

A modern, performant build tool is essential to provide fast development experience while producing optimized production bundles.

## Decision

All **frontends built on the Dasolve framework** must use **Vite** (version 5 or later) as the build tool and development server.

Vite will be configured with:

- **TypeScript** support via `@vitejs/plugin-react`
- **React Fast Refresh** for instant feedback during development
- **ES Modules (ESM)** as the primary module format
- **Code splitting** and **lazy loading** for optimal bundle sizes
- **Environment variables** management for different deployment environments

This decision ensures all Dasolve frontends benefit from blazing-fast development experience and optimized production builds.

## Do's and Don'ts

### Do

- **DO** use Vite for all new frontend projects.
- **DO** leverage Vite's native ES modules support in development for instant server start.
- **DO** use `@vitejs/plugin-react`.
- **DO** configure code splitting and lazy loading using dynamic imports (`React.lazy`, `import()`).
- **DO** use Vite's environment variable system (`.env` files with `VITE_` prefix) for configuration.
- **DO** configure separate build settings for development and production environments.
- **DO** use Vite's built-in asset handling for images, fonts, and other static resources.

### Don't

- **DON'T** use Webpack, Parcel, Create React App, or other bundlers for new Dasolve frontend projects.
- **DON'T** eject from Vite or create overly complex custom configurations. Keep configurations simple and maintainable.
- **DON'T** import files without extensions in TypeScript code (configure Vite to enforce explicit extensions).
- **DON'T** use CommonJS (`require`, `module.exports`) in frontend code. Use ES modules exclusively.
- **DON'T** commit `.env.local` or `.env.*.local` files to version control (they contain local/secret values).
- **DON'T** manually concatenate or bundle files. Let Vite handle all bundling automatically.

## Consequences

### Positive

- **Lightning-Fast Development:** Vite's dev server starts instantly (<1 second) regardless of project size, using native ES modules.
- **Instant Hot Module Replacement:** Changes reflect in the browser in milliseconds with React Fast Refresh.
- **Optimized Production Builds:** Vite uses Rollup under the hood for highly optimized, tree-shaken production bundles.
- **Simple Configuration:** Vite requires minimal configuration out of the box, with sensible defaults.
- **Modern Tooling:** Built for modern JavaScript, TypeScript, and ES modules from the ground up.
- **Active Development:** Vite is actively maintained and rapidly evolving with strong community support.
- **Great Developer Experience:** Excellent error messages, fast feedback loops, and comprehensive documentation.
- **Framework Agnostic:** While we use it for React, Vite supports multiple frameworks, making it future-proof.

### Negative

- **Learning Curve:** Developers familiar with Webpack will need to learn Vite's configuration system and concepts.
- **Different Behavior:** Dev and production modes use different bundlers (native ESM vs Rollup), which can occasionally cause inconsistencies.
- **Plugin Ecosystem:** While growing rapidly, Vite's plugin ecosystem is smaller than Webpack's (though most common needs are covered).
- **Node.js Version Requirement:** Vite requires relatively recent Node.js versions (though this aligns with ADR-006 constraints).

### Risks

- **Development/Production Parity:** Different bundling strategies in dev (native ESM) vs production (Rollup) might cause subtle bugs.
- **Breaking Changes:** Vite is evolving rapidly and may introduce breaking changes in major versions. This will be mitigated by:
  - Pinning Vite versions in package.json
  - Thoroughly testing upgrades in staging environments
  - Following Vite's migration guides carefully

## Compliance and Enforcement

### Enforcement

- **Project Templates:** All Dasolve frontend scaffolding will include Vite pre-configured with:
  - TypeScript support
  - React Fast Refresh enabled
  - Environment variable templates
  - Production-ready configuration
- **Build Scripts:** Build scripts are managed by Moonrepo (ADR-010) task runner, not package.json. Standard tasks:
  - `moon run frontend:dev` - Start development server
  - `moon run frontend:build` - Build for production (includes TypeScript checking)
  - `moon run frontend:preview` - Preview production build
- **CI/CD Integration:** Build pipelines will use Moonrepo tasks for building and type checking.
- **Code Reviews:** Reviewers must ensure:
  - No Webpack or other bundler configurations are introduced
  - ES modules are used exclusively
  - Environment variables follow Vite's `VITE_` prefix convention
  - Configuration remains simple and maintainable

### Standard Configuration

A minimal `vite.config.ts` for Dasolve frontends:

```typescript
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";

export default defineConfig({
  plugins: [react()],
  server: {
    port: 3000,
  },
  build: {
    outDir: "dist",
    sourcemap: true,
  },
});
```

### Exceptions

- Exceptions to this ADR are rare and must be approved by the project's lead architect or the Dasolve framework core maintainers.
- All approved exceptions must be documented as a separate ADR that outlines the business/technical justification and the scope of the exception.

## References

- [ADR-001: Primary Programming Language (TypeScript)](ADR-001.md)
- [ADR-003: Bun Package Manager](ADR-003.md)
- [ADR-005: Bun Runtime](ADR-005.md)
- [ADR-014: SPA Architecture](ADR-014.md)
- [ADR-015: React.JS Framework](ADR-015.md)
- [Vite Official Documentation](https://vitejs.dev/)
- [Vite Guide: Why Vite](https://vitejs.dev/guide/why.html)
