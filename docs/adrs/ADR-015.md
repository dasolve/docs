# ADR-015: Single Page Application (SPA) Architecture

## Context

Modern web applications require responsive, fluid user experiences with minimal page reloads. Traditional multi-page applications (MPAs) that perform full page refreshes for every navigation create poor user experiences with:

- Visible loading states and flashing during navigation
- Loss of application state between page transitions
- Slower perceived performance due to full page reloads
- Difficulty maintaining complex UI state across pages
- Inefficient resource loading (re-downloading assets on each navigation)

The Dasolve framework specifically targets **enterprise data-driven applications** with unique characteristics:

- **Long-Running Sessions:** Users keep the application open in their browser for extended periods (hours or even days), working with data continuously without closing the browser.
- **No SEO Requirements:** Enterprise applications are internal tools, not public-facing websites. They do not need to be indexed by search engines and are typically protected behind authentication.
- **Complex Stateful Workflows:** Enterprise users engage in multi-step workflows that require maintaining complex state across many views and interactions.
- **Rich Data Interactions:** Applications involve extensive data visualization, filtering, sorting, and real-time updates that benefit from client-side state management.

Additionally, without a standardized frontend architecture, solutions built on the Dasolve framework would vary widely in their approach, making it difficult to:

- Share components and patterns across different frontend projects
- Provide consistent tooling and build configurations
- Enable developers to move between projects easily
- Establish best practices for state management, routing, and data fetching

A clear architectural decision is needed to ensure all Dasolve frontends deliver modern, performant user experiences optimized for enterprise use cases while maintaining consistency across the ecosystem.

## Decision

All **frontends built on the Dasolve framework** must follow the **Single Page Application (SPA)** architecture.

In this architecture:

- The initial page load delivers a minimal HTML shell and JavaScript bundle
- All subsequent navigation and UI updates occur dynamically via JavaScript without full page reloads
- The browser's URL is updated programmatically using the History API
- Data is fetched asynchronously from backend APIs as needed
- The application maintains state throughout the user session, even across extended periods

This decision ensures all Dasolve frontends provide modern, app-like experiences optimized for long-running enterprise sessions with fluid navigation and optimized performance.

## Do's and Don'ts

### Do

- **DO** build frontends as single-page applications where all routing and navigation happens client-side without full page reloads.
- **DO** use the History API (via TanStack Router per ADR-017) to update the URL and browser history during client-side navigation.
- **DO** implement proper loading states and error boundaries to handle asynchronous operations gracefully.
- **DO** use code splitting and lazy loading to optimize initial bundle size and load time.
- **DO** implement proper memory management and cleanup to support long-running browser sessions (hours or days).
- **DO** provide fallback content and error pages for scenarios where JavaScript fails to load or execute.
- **DO** implement session persistence and recovery mechanisms for long-running sessions.

### Don't

- **DON'T** use server-side rendering (SSR) or static site generation (SSG) frameworks like Next.js, Remix, or Astro. These violate the SPA architecture decision.
- **DON'T** implement full page reloads for navigation between routes within the application.
- **DON'T** use traditional HTML forms with POST actions that cause page refreshes. All form submissions should be handled with JavaScript.
- **DON'T** rely on server-rendered HTML for the main application content. The server should only deliver the minimal HTML shell.
- **DON'T** create separate HTML files for each route. All routes should be handled by the single-page application.
- **DON'T** optimize for SEO or search engine crawlers. Enterprise applications are internal tools that should not be indexed.

## Consequences

### Positive

- **Superior User Experience:** Instant navigation between routes without page flashes or loading delays creates a fluid, app-like experience.
- **Optimal for Long Sessions:** Perfect for enterprise users who keep applications open for extended periods, as state is maintained without server round-trips.
- **Efficient Resource Usage:** Static assets (JavaScript, CSS, fonts) are loaded once and cached, reducing bandwidth and improving performance over long sessions.
- **Rich Interactivity:** The architecture enables complex, stateful interactions that would be difficult or impossible with traditional MPAs.
- **No SEO Complexity:** Since enterprise applications don't need search engine indexing, we avoid the complexity of SSR/SSG while still meeting all requirements.
- **Simplified Deployment:** The entire frontend is a static bundle that can be served from any CDN or web server without server-side rendering requirements.
- **Better Developer Experience:** Clear separation between frontend and backend simplifies development and testing.
- **Consistent Ecosystem:** All Dasolve frontends follow the same architecture, enabling shared tooling, components, and best practices.

### Negative

- **Initial Load Time:** The first page load may be slower than an MPA as the JavaScript bundle must be downloaded and executed before the UI is interactive. However, this is a one-time cost for long-running sessions.
- **Accessibility Concerns:** Requires careful implementation of focus management, screen reader announcements, and ARIA attributes for dynamic content updates.
- **Browser History Management:** Developers must properly manage browser history and handle back/forward navigation programmatically.
- **Memory Management Complexity:** Long-running SPAs require careful attention to memory leaks, event listener cleanup, and proper component unmounting to avoid degradation over extended sessions.

### Risks

- **Memory Leaks in Long Sessions:** For enterprise applications running for hours or days, memory leaks can accumulate and degrade performance. This will be mitigated by:
  - Enforcing proper cleanup in React components (useEffect cleanup functions)
  - Using React DevTools Profiler to identify memory leaks during development
  - Implementing automated memory leak detection in CI/CD
- **JavaScript Dependency:** Users with JavaScript disabled will not be able to use the application. This is acceptable for enterprise environments where JavaScript is universally supported and required.

## Compliance and Enforcement

### Enforcement

- **Build Configuration:** All frontend projects will use Vite (ADR-016) which is optimized for SPA development and will be configured to produce SPA bundles.
- **Routing:** The mandatory use of TanStack Router (ADR-017) enforces client-side routing without page reloads.
- **Project Templates:** Official Dasolve frontend scaffolding will generate SPA-configured projects with the proper Vite setup and routing structure.
- **Code Reviews:** Reviewers must ensure that:
  - No server-side rendering or multi-page patterns are introduced
  - Proper memory cleanup is implemented for long-running sessions
  - Components properly unmount and clean up event listeners
- **Testing:** Performance and memory leak testing must be included in CI/CD to detect issues that could impact long-running sessions.

### Exceptions

- Landing pages, marketing sites, or documentation sites that are separate from the main application may use different architectures (e.g., static site generators) and are out of the scope of the framework and should be treated separately outside of the context of the solution.
- Exceptions to this ADR are rare and must be approved by the project's lead architect or the Dasolve framework core maintainers.
- All approved exceptions must be documented as a separate ADR that outlines the business/technical justification and the scope of the exception.

## References

- [ADR-016: Vite Build Tool](ADR-016.md)
- [ADR-017: TanStack Router](ADR-017.md)
- [Single Page Application - Wikipedia](https://en.wikipedia.org/wiki/Single-page_application)
