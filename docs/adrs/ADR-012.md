# ADR-012: Standardized Formatting

## Context

Following the decision to enforce linting for code _correctness_ ([ADR-011](ADR-011.md)), we must also enforce a single standard for code _style_.

Code formatting is a major source of debate and developer friction. In a hybrid workforce of human and AI/LLM developers, stylistic consistency is critical for readability and maintainability. AI-generated code can have wild variations in style, and human developers have their own preferences.

We require a "zero-tolerance" policy for formatting, where a single, opinionated tool makes all stylistic decisions. This tool must be fast and integrate seamlessly with our standard IDE, **VSCode** ([ADR-009](ADR-009.md)), and our monorepo orchestrator, **Moonrepo** ([ADR-010](ADR-010.md)).

## Decision

Formatting will be mandatory and enforced in all Dasolve repositories.

1. For all **TypeScript**, **JSON**, **YAML**, and **Markdown** files, we will standardize on **Prettier** as the exclusive formatter.

2. For all **Python** code, we will standardize on **Ruff Formatter** as the exclusive formatter.

These tools will be configured to run automatically in the IDE (e.g., on save) and will be enforced via a check in all CI/CD pipelines.

## Consequences

### Positive

- **Eliminates All Style Debates:** The formatter's output is the final word. This removes an entire category of subjective arguments from code reviews.

- **Total Consistency:** All code, whether written by a senior developer, a junior developer, or an LLM, will be visually indistinguishable. This dramatically improves readability and reduces cognitive load.

- **Ecosystem-Best Tooling:**

  - **Prettier** is the industry-defining standard for the entire web ecosystem. It handles TypeScript, JSON, YAML, and Markdown, ensuring consistency _beyond_ just source code.
  - **Ruff Formatter** is written in Rust, is extremely fast, and is a drop-in replacement for `black` and `isort`. It consolidates Python formatting into the same tool we use for Python linting ([ADR-011](ADR-011.md)).

- **Perfect Integration:** Both Prettier and Ruff have excellent VSCode extensions for "format on save" and are simple to configure as tasks in Moonrepo.

### Negative

- **Opinionated:** The primary benefit is also the main drawback. Developers who dislike Prettier's line-wrapping rules or Ruff's `black`-compatible style do not have an alternative. This is a deliberate trade-off in favor of consistency.

- **Two Formatters:** We are intentionally adopting two separate formatters. While this adds a minor configuration overhead (one for web, one for Python), it allows us to use the best-in-class, fastest tool for each ecosystem, rather than forcing a sub-optimal tool (e.g., Prettier's Python plugin) on one.

## Do's and Don'ts

This section provides clear guidelines for adhering to this decision.

### Do

- **DO** integrate `prettier --check` as a `format-check` task in the `.moon/tasks/typescript.yml` files for all web/TypeScript projects.

- **DO** integrate `ruff format --check` as a `format-check` task in the `.moon/tasks/python.yml` for all Python projects.

- **DO** run all `format-check` tasks as part of the `moon ci` command. Builds **must** fail on formatting errors.

- **DO** use the `esbenp.prettier-vscode` (Prettier) and `charliermarsh.ruff` (Ruff) extensions in VSCode.

- **DO** configure your VSCode `settings.json` to "format on save" using these tools.

### Don't

- **DON'T** use any other formatter. For Python, do not use `black`, `isort`, `yapf`, etc. For web, do not use ESLint for formatting.

- **DON'T** debate formatting rules in a pull request. If the code passes the formatter, the style is correct.

- **DON'T** commit unformatted code.

- **DON'T** disable or add "allow failure" exceptions for `format-check` tasks in the CI/CD pipeline.

## Compliance and Enforcement

1. **Moonrepo Configuration:** All official Dasolve project scaffolds will include `prettier` and `ruff format` tasks in their `moon.yml` files by default. Moon's toolchain will be used to pin the versions of these tools.

2. **CI/CD Pipeline:** The central CI/CD workflow will execute `moon ci`, which will automatically run the `format-check` tasks for all affected projects. A failure in any of these tasks will fail the build.

3. **VSCode Recommendations:** The workspace `.vscode/extensions.json` file will list `esbenp.prettier-vscode` and `charliermarsh.ruff` as recommended extensions. The workspace `.vscode/settings.json` will be pre-configured for format-on-save.

4. **Exceptions:**
   - Exceptions to this ADR are rare and must be approved by the project's lead architect or the Dasolve framework steering committee.
   - All approved exceptions must be documented as a separate ADR that outlines the business/technical justification and the scope of the exception.

## References

- **Prettier:** [https://prettier.io/](https://prettier.io/)

- **Ruff Formatter:** [https://docs.astral.sh/ruff/formatter/](https://docs.astral.sh/ruff/formatter/)
