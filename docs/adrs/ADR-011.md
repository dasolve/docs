# ADR-011: Standardized Linting

## Context

Dasolve solutions will be polyglot, primarily using **TypeScript** ([ADR-002](ADR-002.md)) and **Python** ([ADR-004](ADR-004.md)). Maintaining code quality and correctness is critical for long-term maintainability. This challenge is magnified by a hybrid workforce of human and AI/LLM developers, where AI-generated code must be held to the same high standard.

Traditional linters, like ESLint or Pylint, are often slow, require complex configuration, and have a large dependency footprint. We require a solution that is:

1. **Extremely Fast:** Provides instant feedback in the IDE and runs quickly in CI.

2. **Easy to Configure:** Has sensible defaults and a simple configuration format.

3. **Comprehensive:** Covers a wide range of correctness rules.

4. **Well-Integrated:** Works seamlessly with our chosen monorepo tool, **Moonrepo** ([ADR-010](ADR-010.md)), and IDE, **VSCode** ([ADR-009](ADR-009.md)).

## Decision

Linting will be mandatory and enforced in all Dasolve repositories.

1. For all **TypeScript** code, we will standardize on **Oxlint** as the exclusive linter.

2. For all **Python** code, we will standardize on **Ruff** as the exclusive linter.

These tools will be integrated into the monorepo to run on every commit and pull request.

## Consequences

### Positive

- **Extreme Performance:** Both Oxlint and Ruff are written in Rust and provide performance that is 50-100x faster than their Node.js/Python counterparts (ESLint, Pylint). This means near-instant feedback for developers and faster CI/CD pipelines.

- **Consolidated Tooling:**

  - **Ruff** replaces a multitude of tools (Flake8, Pylint, isort, etc.) with a single, high-performance binary for linting.
  - **Oxlint** provides a high-speed linter for TypeScript.

- **Simplified Configuration:** We will manage one `ruff.toml` (or `pyproject.toml`) for Python and one `oxlint.json` for TypeScript, drastically reducing configuration overhead.

- **Improved Consistency:** A single, enforced set of rules for each language ensures all code, whether written by a senior developer or an LLM, adheres to the same quality guidelines.

- **Excellent Integration:** Both tools have mature VSCode extensions and can be easily configured as tasks within Moonrepo, fitting perfectly into our standard development ecosystem.

### Negative

- **Oxlint Ecosystem:** Oxlint is newer than ESLint. While it covers the most critical rules (especially from `eslint-plugin-react`, `eslint-plugin-typescript`, etc.), it does not yet have 1:1 parity with the entire ESLint plugin ecosystem. We may lose some highly specific, niche rules.

- **Developer Preference:** Developers familiar with ESLint's flexibility and ecosystem will need to adapt to Oxlint.

## Do's and Don'ts

This section provides clear guidelines for adhering to this decision.

### Do

- **DO** integrate `oxlint` as the `lint` task in the `.moon/tasks/typescript.yml` for all TypeScript projects.

- **DO** integrate `ruff check` as the `lint` task in the `.moon/tasks/python.yml` for all Python projects.

- **DO** run `oxlint` and `ruff check` as part of the `moon ci` command in all CI/CD pipelines. Builds **must** fail on linting errors.

- **DO** use the `oxc-vscode` (Oxlint) and `charliermarsh.ruff` (Ruff) extensions in VSCode. These will be part of the recommended extensions.

### Don't

- **DON'T** use ESLint or TSLint for TypeScript code. Oxlint is the standard linter.

- **DON'T** use Pylint, Flake8, or any other linter for Python code. Ruff is the standard linter.

- **DON'T** add configuration files for any other linter (e.g., `.eslintrc.js`). Configuration for Ruff (`ruff.toml`) and Oxlint (`oxlint.json`) is allowed.

- **DON'T** disable or add "allow failure" exceptions for linting tasks in the CI/CD pipeline.

## Compliance and Enforcement

1. **Moonrepo Configuration:** All official Dasolve project scaffolds will include `oxlint` and `ruff` tasks in their `moon.yml` files by default. Moon's toolchain will be used to pin the versions of these tools.

2. **CI/CD Pipeline:** The central CI/CD workflow will execute `moon ci`, which will automatically run the `lint` tasks for all affected projects. A failure in any of these tasks will fail the build.

3. **VSCode Recommendations:** The workspace `.vscode/extensions.json` file will list `oxc-vscode` and `charliermarsh.ruff` as recommended extensions, prompting developers to install them.

4. **Exceptions:**
   - Exceptions to this ADR are rare and must be approved by the project's lead architect or the Dasolve framework steering committee.
   - All approved exceptions must be documented as a separate ADR that outlines the business/technical justification and the scope of the exception.

## References

- **Oxlint:** [https://oxc-project.github.io/docs/guide/linter.html](https://oxc-project.github.io/docs/guide/linter.html)

- **Ruff:** [https://docs.astral.sh/ruff/](https://docs.astral.sh/ruff/)

- [ADR-002: TypeScript as the Primary Language](ADR-002.md)

- [ADR-004: Python as the Scripting Language](ADR-004.md)

- [ADR-009: VSCode and its forks is the IDE](ADR-009.md)

- [ADR-010: Moonrepo as the Standard Monorepo Tool](ADR-010.md)
